<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farm2Home - Bubble Edition</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Import Map -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
      }
    }
    </script>
    <style>
        /* Custom Scrollbar for Bubble Feel */
        ::-webkit-scrollbar {
            width: 12px;
        }
        ::-webkit-scrollbar-track {
            background: #f0fdf4; 
        }
        ::-webkit-scrollbar-thumb {
            background-color: #86efac; 
            border-radius: 20px; 
            border: 3px solid #f0fdf4;
        }
        body {
            background-color: #f0fdf4;
            background-image: radial-gradient(#dcfce7 2px, transparent 2px);
            background-size: 32px 32px;
        }
    </style>
</head>
<body class="text-gray-800 font-sans antialiased selection:bg-lime-300 selection:text-green-900">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
          Leaf, Truck, ShieldCheck, Heart, Search, ShoppingCart, 
          User, ChevronRight, ArrowRight, Menu, X, MapPin, Star, 
          Facebook, Twitter, Instagram, Upload, FileText, CheckCircle, 
          XCircle, AlertCircle, Package, DollarSign, Users, ClipboardList, Loader2, QrCode, Image as ImageIcon, LayoutDashboard, Info, Home, Mail, Trash2, Box, Edit2, AlertTriangle, Copy, Phone, ExternalLink, Sparkles
        } from 'lucide-react';

        // --- FIREBASE IMPORTS ---
        import { initializeApp } from 'firebase/app';
        import { 
          getAuth, 
          createUserWithEmailAndPassword, 
          signInWithEmailAndPassword, 
          signOut, 
          onAuthStateChanged,
          deleteUser 
        } from 'firebase/auth';
        import { 
          getFirestore, 
          collection, 
          addDoc, 
          getDocs, 
          doc, 
          setDoc, 
          getDoc, 
          updateDoc, 
          onSnapshot, 
          query, 
          where,
          serverTimestamp,
          limit,
          orderBy,
          deleteDoc 
        } from 'firebase/firestore';

        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
          apiKey: "AIzaSyCTV6gg2QXLHJMSGvOWIa-YDy5-PvrgeHk",
          authDomain: "farm2home-2f7ff.firebaseapp.com",
          projectId: "farm2home-2f7ff",
          storageBucket: "farm2home-2f7ff.firebasestorage.app",
          messagingSenderId: "656644623315",
          appId: "1:656644623315:web:0d59d865c82b5c9b4e7d26",
          measurementId: "G-XFQFK8Q9TZ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // --- HELPER: Upload to Cloudinary ---
        const uploadToCloudinary = async (file) => {
          const formData = new FormData();
          formData.append("file", file);
          formData.append("upload_preset", "Farm2Home");
          const res = await fetch("https://api.cloudinary.com/v1_1/drf5cbuzu/auto/upload", { method: "POST", body: formData });
          if (!res.ok) throw new Error("Cloudinary upload failed");
          const data = await res.json();
          return data.secure_url;
        };

        const MOD_EMAILS = ['aadityabillawa@gmail.com', 'zeyamalam@gmail.com'];

        const FEATURES = [
          { title: '100% Organic', icon: <Leaf className="w-8 h-8 text-white" />, color: 'bg-green-500', description: 'Certified organic, grown with love.' },
          { title: 'Fast Delivery', icon: <Truck className="w-8 h-8 text-white" />, color: 'bg-emerald-500', description: 'Farm to table in record time.' },
          { title: 'Quality First', icon: <ShieldCheck className="w-8 h-8 text-white" />, color: 'bg-teal-500', description: 'Hand-picked premium quality.' },
          { title: 'Community', icon: <Heart className="w-8 h-8 text-white" />, color: 'bg-lime-500', description: 'Supporting local growers.' },
        ];

        // --- BUBBLE COMPONENTS ---
        const BubbleButton = ({ children, onClick, variant = 'primary', className = '', disabled = false, type = 'button' }) => {
            const baseStyle = "px-6 py-3 rounded-full font-bold transition-all transform hover:scale-105 active:scale-95 shadow-lg flex items-center justify-center gap-2";
            const variants = {
                primary: "bg-green-600 text-white hover:bg-green-500 shadow-green-200",
                secondary: "bg-white text-green-700 hover:bg-green-50 border-2 border-green-100",
                danger: "bg-red-500 text-white hover:bg-red-400 shadow-red-200",
                dark: "bg-gray-900 text-white hover:bg-gray-800"
            };
            return (
                <button type={type} disabled={disabled} onClick={onClick} className={`${baseStyle} ${variants[variant]} ${disabled ? 'opacity-50 cursor-not-allowed hover:scale-100' : ''} ${className}`}>
                    {children}
                </button>
            );
        };

        const BubbleInput = ({ ...props }) => (
            <input {...props} className={`w-full px-6 py-4 rounded-full bg-white border-2 border-green-50 focus:border-green-400 focus:ring-4 focus:ring-green-100 outline-none transition-all shadow-sm text-gray-700 placeholder-gray-400 ${props.className}`} />
        );

        const BubbleCard = ({ children, className = '' }) => (
            <div className={`bg-white rounded-[2.5rem] p-8 shadow-xl shadow-green-900/5 border border-white/50 backdrop-blur-sm ${className}`}>
                {children}
            </div>
        );

        const ConfirmationModal = ({ isOpen, title, message, onConfirm, onCancel, confirmText = "Confirm", isDangerous = false }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-green-900/40 backdrop-blur-md animate-in fade-in duration-300">
                    <BubbleCard className="max-w-md w-full text-center relative overflow-hidden">
                        <div className={`w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 ${isDangerous ? 'bg-red-100 text-red-500' : 'bg-green-100 text-green-500'}`}>
                            {isDangerous ? <AlertTriangle className="w-10 h-10"/> : <Info className="w-10 h-10"/>}
                        </div>
                        <h3 className="text-3xl font-black text-gray-800 mb-3">{title}</h3>
                        <p className="text-gray-500 mb-8 font-medium">{message}</p>
                        <div className="flex gap-4 justify-center">
                            <BubbleButton variant="secondary" onClick={onCancel}>Cancel</BubbleButton>
                            <BubbleButton variant={isDangerous ? "danger" : "primary"} onClick={onConfirm}>{confirmText}</BubbleButton>
                        </div>
                    </BubbleCard>
                </div>
            );
        };

        function App() {
          const [products, setProducts] = useState([]); 
          const [currentUser, setCurrentUser] = useState(null);
          const [loading, setLoading] = useState(true);
          const [view, setView] = useState('home'); 
          const [authMode, setAuthMode] = useState('login'); 
          const [isMenuOpen, setIsMenuOpen] = useState(false);
          const [notification, setNotification] = useState(null);

          useEffect(() => {
            const unsubscribe = onAuthStateChanged(auth, async (user) => {
              if (user) {
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                  const data = userDoc.data();
                  if (MOD_EMAILS.includes(user.email.toLowerCase()) && data.role !== 'mod') {
                      await updateDoc(doc(db, "users", user.uid), { role: 'mod', status: 'active' });
                      data.role = 'mod';
                  }
                  setCurrentUser({ uid: user.uid, ...data });
                  if (view === 'auth') {
                      if (data.role === 'farmer') setView('farmer-panel');
                      else if (data.role === 'mod') setView('mod-panel');
                      else if (data.role === 'buyer') setView('marketplace');
                      else setView('home');
                  }
                } else {
                    setCurrentUser({ uid: user.uid, role: 'unknown', name: user.email });
                }
              } else {
                setCurrentUser(null);
              }
              setLoading(false);
            });
            return () => unsubscribe();
          }, []);

          useEffect(() => {
            const q = query(collection(db, "products"));
            const unsubscribeProducts = onSnapshot(q, (snapshot) => {
              setProducts(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
            });
            return () => unsubscribeProducts();
          }, []);

          const showNotification = (msg, type) => {
            setNotification({ msg, type });
            setTimeout(() => setNotification(null), 4000);
          };

          const handleSignup = async (formData, file, setUploadProgress) => {
            setLoading(true);
            let user = null;
            try {
              const userCredential = await createUserWithEmailAndPassword(auth, formData.email, formData.password);
              user = userCredential.user;
              let docUrl = "";
              if (file) {
                if(setUploadProgress) setUploadProgress(50); 
                docUrl = await uploadToCloudinary(file);
                if(setUploadProgress) setUploadProgress(100);
              }
              let role = formData.role;
              let status = (formData.role === 'farmer') ? 'pending' : 'active';
              if (MOD_EMAILS.includes(formData.email.toLowerCase())) { role = 'mod'; status = 'active'; }
              const userData = {
                name: formData.name, email: formData.email, phone: formData.phone || "",
                address: formData.address || "", role: role, status: status, aadhar: formData.aadhar || "",
                docUrl: docUrl, qrCodeUrl: "", upiId: "", joinedDate: serverTimestamp(), rejectionReason: null
              };
              await setDoc(doc(db, "users", user.uid), userData);
              showNotification("Welcome to the family!", "success");
              setCurrentUser({ uid: user.uid, ...userData });
              if (role === 'farmer') setView('farmer-panel'); else if (role === 'mod') setView('mod-panel'); else setView('marketplace');
            } catch (error) { showNotification(error.message, "error"); if (user) try { await deleteUser(user); } catch(e) {} } finally { setLoading(false); if(setUploadProgress) setUploadProgress(0); }
          };

          const handleLogin = async (email, password) => {
            setLoading(true);
            try {
              const userCredential = await signInWithEmailAndPassword(auth, email, password);
              const userDoc = await getDoc(doc(db, "users", userCredential.user.uid));
              showNotification("Welcome back!", "success");
              if (userDoc.exists()) {
                  const data = userDoc.data();
                  if (data.role === 'farmer') setView('farmer-panel'); else if (data.role === 'mod') setView('mod-panel'); else setView('marketplace');
              } else setView('home');
            } catch (error) { showNotification("Invalid credentials", "error"); } finally { setLoading(false); }
          };

          const handleLogout = async () => { await signOut(auth); setView('home'); };

          const addProduct = async (productData) => {
            if (!currentUser) return;
            try {
              await addDoc(collection(db, "products"), { ...productData, farmerId: currentUser.uid, farmerName: currentUser.name, status: 'pending', createdAt: serverTimestamp() });
              showNotification("Product pending approval!", "success");
            } catch (error) { showNotification("Error adding product", "error"); }
          };

          const savePaymentSettings = async (file, upiId) => {
             if (!currentUser) return;
             try {
                 let updateData = { upiId };
                 if (file) updateData.qrCodeUrl = await uploadToCloudinary(file);
                 await updateDoc(doc(db, "users", currentUser.uid), updateData);
                 setCurrentUser({...currentUser, ...updateData});
                 showNotification("Settings saved!", "success");
             } catch (error) { showNotification("Failed to save", "error"); }
          };

          const placeOrder = async (orderPayload) => {
            try {
              await addDoc(collection(db, "orders"), { ...orderPayload, date: new Date().toISOString(), status: 'Under Review', createdAt: serverTimestamp() });
              for (const item of orderPayload.items) {
                const prodRef = doc(db, "products", item.id);
                const prodSnap = await getDoc(prodRef);
                if (prodSnap.exists()) await updateDoc(prodRef, { stock: prodSnap.data().stock - item.quantity });
              }
              showNotification("Order placed! Awaiting farmer confirmation.", "success");
            } catch (error) { showNotification("Failed to place order", "error"); }
          };

          const handleModAction = async (userId, action, reason = "") => {
            try {
              await updateDoc(doc(db, "users", userId), { status: action === 'approve' ? 'active' : 'rejected', rejectionReason: reason });
              showNotification(`User ${action === 'approve' ? 'Approved' : 'Rejected'}`, "success");
            } catch (error) { showNotification("Action failed", "error"); }
          };

          const handleProductApproval = async (productId, action, reason = "") => {
            try {
                await updateDoc(doc(db, "products", productId), { status: action === 'reject' ? 'rejected' : 'approved', rejectionReason: action === 'reject' ? reason : null });
                showNotification(`Product ${action === 'reject' ? 'Rejected' : 'Approved'}`, "success");
            } catch (error) { showNotification("Action failed", "error"); }
          };

          // --- UI COMPONENTS ---
          
          const Navbar = () => (
            <nav className="fixed top-6 left-0 right-0 z-50 flex justify-center px-4">
              <div className="bg-white/80 backdrop-blur-xl border border-white/40 shadow-xl shadow-green-900/5 rounded-full px-6 py-3 max-w-6xl w-full flex justify-between items-center transition-all duration-300">
                <div className="flex items-center gap-2 cursor-pointer group" onClick={() => setView('home')}>
                  <div className="bg-green-500 p-2 rounded-full text-white group-hover:rotate-12 transition-transform shadow-lg shadow-green-200">
                    <Leaf size={20} fill="currentColor" />
                  </div>
                  <span className="text-xl font-black text-gray-800 tracking-tight">Farm<span className="text-green-500">2</span>Home</span>
                </div>
                
                <div className="hidden md:flex items-center gap-2 font-bold text-sm text-gray-500 bg-gray-100/50 p-1.5 rounded-full">
                   {['home', 'marketplace', 'about'].map((v) => (
                       <button key={v} onClick={() => currentUser?.role === 'farmer' && v === 'marketplace' ? setView('farmer-panel') : setView(v)} className={`px-5 py-2 rounded-full transition-all ${view === v ? 'bg-white text-green-600 shadow-md shadow-gray-200' : 'hover:bg-gray-200/50'}`}>
                           {v.charAt(0).toUpperCase() + v.slice(1)}
                       </button>
                   ))}
                </div>

                <div className="hidden md:flex items-center gap-3">
                  {!currentUser ? (
                    <>
                      <button onClick={() => { setView('auth'); setAuthMode('login'); }} className="px-5 py-2.5 rounded-full font-bold text-gray-500 hover:bg-gray-100 transition-colors">Sign In</button>
                      <BubbleButton onClick={() => { setView('auth'); setAuthMode('signup'); }} className="!px-6 !py-2.5 !text-sm">Join Now</BubbleButton>
                    </>
                  ) : (
                    <div className="flex items-center gap-3 pl-2 bg-gray-50 rounded-full pr-1 py-1 border border-gray-100">
                      <div className="flex flex-col items-end leading-none">
                          <span className="text-xs font-bold text-gray-800">{currentUser.name}</span>
                          <span className="text-[10px] uppercase font-bold text-green-500">{currentUser.role}</span>
                      </div>
                      <div className="w-8 h-8 bg-green-200 rounded-full flex items-center justify-center text-green-700 font-bold border-2 border-white shadow-sm">
                          {currentUser.name[0]}
                      </div>
                      <button onClick={handleLogout} className="bg-white p-2 rounded-full hover:bg-red-50 text-gray-400 hover:text-red-500 transition-colors shadow-sm ml-1">
                          <ExternalLink size={14}/>
                      </button>
                    </div>
                  )}
                </div>
                <button className="md:hidden p-2 bg-gray-100 rounded-full" onClick={() => setIsMenuOpen(!isMenuOpen)}>{isMenuOpen ? <X size={20}/> : <Menu size={20}/>}</button>
              </div>
            </nav>
          );

          const AboutUs = () => (
            <div className="pt-32 pb-20 relative overflow-hidden">
                <div className="absolute top-20 right-0 w-96 h-96 bg-green-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>
                <div className="absolute top-40 left-0 w-96 h-96 bg-lime-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>
                <div className="max-w-4xl mx-auto px-6 relative z-10 text-center">
                    <span className="inline-block py-2 px-6 rounded-full bg-white border border-green-100 text-green-600 font-bold text-sm shadow-lg mb-8">üå± Our Mission</span>
                    <h2 className="text-6xl font-black text-gray-800 mb-8 leading-tight">Grown by <span className="text-green-500">Neighbors</span>,<br/>Enjoyed by Friends.</h2>
                    <BubbleCard className="text-left prose prose-lg max-w-none text-gray-500 leading-relaxed mb-12 relative overflow-visible">
                        <div className="absolute -top-6 -left-6 text-6xl opacity-20 rotate-12">ü•¶</div>
                        <div className="absolute -bottom-6 -right-6 text-6xl opacity-20 -rotate-12">ü•ï</div>
                        <p>At Farm2Home, we don't just sell vegetables; we build relationships. We believe the path from soil to soul should be short, transparent, and joyful.</p>
                        <p>By empowering local farmers with a direct marketplace, we ensure they get fair value for their hard work, while you get produce that still tastes like nature intended.</p>
                    </BubbleCard>
                    <div className="grid md:grid-cols-3 gap-6">
                        {[
                            {icon: <Users className="w-6 h-6"/>, title: "Fair Trade", desc: "100% earnings to farmers"},
                            {icon: <Heart className="w-6 h-6"/>, title: "Community", desc: "Building local resilience"},
                            {icon: <Leaf className="w-6 h-6"/>, title: "Sustainable", desc: "Zero-mile food print"}
                        ].map((item,i) => (
                            <div key={i} className="bg-white p-6 rounded-[2rem] shadow-lg shadow-green-900/5 flex flex-col items-center">
                                <div className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center text-green-600 mb-4">{item.icon}</div>
                                <h3 className="font-bold text-gray-800 mb-1">{item.title}</h3>
                                <p className="text-sm text-gray-400">{item.desc}</p>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
          );

          const AuthScreen = () => {
            const [role, setRole] = useState('buyer'); 
            const [file, setFile] = useState(null);
            const [uploadProgress, setUploadProgress] = useState(0);
            const [formData, setFormData] = useState({ name: '', email: '', password: '', phone: '', address: '', aadhar: '' });

            const handleSubmit = (e) => {
              e.preventDefault();
              if (authMode === 'login') handleLogin(formData.email, formData.password);
              else handleSignup({ ...formData, role }, file, setUploadProgress);
            };

            return (
              <div className="min-h-screen pt-28 pb-10 flex justify-center px-4">
                <BubbleCard className="w-full max-w-4xl p-0 flex flex-col lg:flex-row overflow-hidden min-h-[600px]">
                    <div className="lg:w-1/2 bg-green-600 p-12 text-white flex flex-col justify-between relative overflow-hidden">
                        <div className="absolute top-0 right-0 w-64 h-64 bg-white opacity-10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
                        <div className="absolute bottom-0 left-0 w-64 h-64 bg-lime-400 opacity-20 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2"></div>
                        <div className="relative z-10">
                            <div className="w-12 h-12 bg-white/20 backdrop-blur-md rounded-2xl flex items-center justify-center mb-6">
                                <Leaf className="text-white"/>
                            </div>
                            <h2 className="text-4xl font-black mb-4">Welcome Back!</h2>
                            <p className="text-green-100 text-lg opacity-90">Join the freshest community on the internet. Good food starts here.</p>
                        </div>
                        <div className="relative z-10 text-sm font-medium opacity-70">¬© 2024 Farm2Home Inc.</div>
                    </div>
                    
                    <div className="lg:w-1/2 p-8 lg:p-12 bg-white flex flex-col justify-center">
                        <div className="text-center mb-8">
                            <h2 className="text-2xl font-black text-gray-800">{authMode === 'login' ? 'Sign In' : 'Create Account'}</h2>
                        </div>
                        {authMode === 'signup' && (
                           <div className="flex bg-gray-100 p-1.5 rounded-full mb-6 relative">
                               {['buyer', 'farmer'].map((r) => (
                                   <button key={r} onClick={() => setRole(r)} className={`flex-1 py-2 rounded-full text-sm font-bold capitalize transition-all relative z-10 ${role === r ? 'bg-white text-green-600 shadow-md' : 'text-gray-400'}`}>{r}</button>
                               ))}
                           </div>
                        )}
                        <form onSubmit={handleSubmit} className="space-y-4">
                            {authMode === 'signup' && (
                                <><BubbleInput placeholder="Full Name" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} required />
                                <div className="relative">
                                    <span className="absolute left-6 top-1/2 -translate-y-1/2 text-gray-400 font-bold border-r pr-3">+91</span>
                                    <BubbleInput className="pl-20" placeholder="Phone Number" value={formData.phone} maxLength={10} onChange={e => setFormData({...formData, phone: e.target.value.replace(/\D/g, '')})} required />
                                </div>
                                {role === 'farmer' && <BubbleInput placeholder="Farm Address" value={formData.address} onChange={e => setFormData({...formData, address: e.target.value})} required />}</>
                            )}
                            <BubbleInput type="email" placeholder="Email Address" value={formData.email} onChange={e => setFormData({...formData, email: e.target.value})} required />
                            <BubbleInput type="password" placeholder="Password" value={formData.password} onChange={e => setFormData({...formData, password: e.target.value})} required />
                            
                            {authMode === 'signup' && role === 'farmer' && (
                                <div className="bg-gray-50 p-6 rounded-[2rem] border border-gray-100 space-y-3">
                                    <p className="text-xs font-bold text-gray-500 uppercase tracking-wider flex items-center gap-2"><ShieldCheck size={14}/> Verification</p>
                                    <BubbleInput placeholder="Aadhar / Govt ID" value={formData.aadhar} onChange={e => setFormData({...formData, aadhar: e.target.value})} required />
                                    <div className="border-2 border-dashed border-gray-200 rounded-3xl p-6 text-center cursor-pointer hover:bg-white transition-colors relative">
                                        <div className="text-sm font-bold text-gray-400">{file ? file.name : "Upload Document"}</div>
                                        <input type="file" required className="absolute inset-0 opacity-0 cursor-pointer" onChange={(e) => setFile(e.target.files[0])} />
                                    </div>
                                </div>
                            )}

                            <BubbleButton type="submit" className="w-full" disabled={loading}>
                                {loading ? <Loader2 className="animate-spin"/> : (authMode === 'login' ? 'Sign In' : 'Create Account')}
                            </BubbleButton>
                        </form>
                        <div className="mt-6 text-center">
                            <button onClick={() => { setAuthMode(authMode === 'login' ? 'signup' : 'login'); setFile(null); }} className="text-sm font-bold text-gray-400 hover:text-green-600 transition-colors">
                                {authMode === 'login' ? "New here? Create Account" : "Have an account? Sign In"}
                            </button>
                        </div>
                    </div>
                </BubbleCard>
              </div>
            );
          };

          // ... (Continuing with Bubble UI transformations for Dashboard/Marketplace)

          const FarmerDashboard = () => {
            const [tab, setTab] = useState('inventory'); 
            const [newProd, setNewProd] = useState({ name: '', price: '', stock: '', unit: 'kg', pesticides: false, description: '', farmAddress: '', state: '' });
            const [prodFile, setProdFile] = useState(null);
            const [uploadingProd, setUploadingProd] = useState(false);
            const [myOrders, setMyOrders] = useState([]);
            const [editingId, setEditingId] = useState(null);
            const [deleteConfirmId, setDeleteConfirmId] = useState(null);
            const [upiId, setUpiId] = useState(currentUser?.upiId || "");

            // ... (keep logic same as original) ...
            useEffect(() => {
              if (tab === 'orders') {
                const q = query(collection(db, "orders"), orderBy("createdAt", "desc"));
                const unsubscribe = onSnapshot(q, (snapshot) => {
                  const allOrders = snapshot.docs.map(d => ({id: d.id, ...d.data()}));
                  setMyOrders(allOrders.filter(o => o.items.some(i => i.farmerId === currentUser.uid)));
                });
                return () => unsubscribe();
              }
            }, [tab, currentUser.uid]);

            const handleSaveProduct = async (e) => {
              e.preventDefault();
              setUploadingProd(true);
              try {
                  let imageUrl = newProd.imageUrl || ""; 
                  if (prodFile) imageUrl = await uploadToCloudinary(prodFile);
                  const productData = { ...newProd, imageUrl, farmerId: currentUser.uid, farmerName: currentUser.name, status: 'pending', updatedAt: serverTimestamp() };
                  if (editingId) { await updateDoc(doc(db, "products", editingId), productData); showNotification("Updated!", "success"); } 
                  else { await addDoc(collection(db, "products"), { ...productData, createdAt: serverTimestamp() }); showNotification("Submitted!", "success"); }
                  setNewProd({ name: '', price: '', stock: '', unit: 'kg', pesticides: false, description: '', farmAddress: '', state: '' });
                  setProdFile(null); setEditingId(null);
              } catch (error) { showNotification("Failed", "error"); } finally { setUploadingProd(false); }
            };

            const handleDeleteProduct = async () => {
                if (deleteConfirmId) {
                    try { await deleteDoc(doc(db, "products", deleteConfirmId)); showNotification("Deleted.", "success"); } catch (error) { showNotification("Error", "error"); }
                    setDeleteConfirmId(null);
                }
            };

            const handleSavePayment = async () => {
                const fileInput = document.getElementById('qr-upload');
                await savePaymentSettings(fileInput?.files[0], upiId);
            };

            const isRestricted = currentUser.status === 'pending' || currentUser.status === 'rejected';

            return (
              <div className="min-h-screen pt-28 pb-12 px-4 max-w-7xl mx-auto">
                <ConfirmationModal isOpen={!!deleteConfirmId} title="Delete?" message="This cannot be undone." isDangerous onConfirm={handleDeleteProduct} onCancel={() => setDeleteConfirmId(null)} />
                
                {isRestricted && (
                    <div className="bg-orange-100 border-l-4 border-orange-500 text-orange-700 p-4 rounded-r-xl mb-8 shadow-sm flex items-center gap-3">
                        <AlertTriangle/> {currentUser.status === 'pending' ? 'Application Under Review.' : `Application Rejected: ${currentUser.rejectionReason}`}
                    </div>
                )}

                <div className={`flex flex-col md:flex-row justify-between items-end mb-10 gap-4 ${isRestricted ? 'opacity-50 pointer-events-none' : ''}`}>
                   <div><h1 className="text-4xl font-black text-gray-800">Farmer Panel</h1><p className="text-gray-500 font-medium">Manage your harvest & earnings</p></div>
                   <div className="bg-white p-1.5 rounded-full shadow-lg border border-gray-100 flex">
                      {['inventory', 'orders', 'settings'].map(t => (
                          <button key={t} onClick={() => setTab(t)} className={`px-6 py-2.5 rounded-full font-bold text-sm transition-all ${tab === t ? 'bg-green-600 text-white shadow-md' : 'text-gray-500 hover:bg-gray-100'}`}>{t.charAt(0).toUpperCase() + t.slice(1)}</button>
                      ))}
                   </div>
                </div>

                <div className={isRestricted ? 'opacity-50 pointer-events-none' : ''}>
                    {tab === 'inventory' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <BubbleCard className="lg:col-span-1 h-fit border-2 border-green-50">
                                <h3 className="text-xl font-bold mb-6 flex items-center gap-2">{editingId ? '‚úèÔ∏è Edit Product' : '‚ûï Add Harvest'}</h3>
                                <form className="space-y-4" onSubmit={handleSaveProduct}>
                                    <BubbleInput placeholder="Product Name" value={newProd.name} onChange={e => setNewProd({...newProd, name: e.target.value})} required />
                                    <div className="grid grid-cols-2 gap-3">
                                        <BubbleInput type="number" placeholder="Price (‚Çπ)" value={newProd.price} onChange={e => setNewProd({...newProd, price: Number(e.target.value)})} required />
                                        <select className="w-full px-6 py-4 rounded-full bg-white border-2 border-green-50 outline-none text-gray-700 appearance-none" value={newProd.unit} onChange={e => setNewProd({...newProd, unit: e.target.value})}>
                                            <option value="kg">/ kg</option><option value="bunch">/ bunch</option><option value="piece">/ piece</option>
                                        </select>
                                    </div>
                                    <BubbleInput type="number" placeholder="Stock Quantity" value={newProd.stock} onChange={e => setNewProd({...newProd, stock: Number(e.target.value)})} required />
                                    <textarea className="w-full px-6 py-4 rounded-[2rem] bg-white border-2 border-green-50 focus:border-green-400 outline-none transition-all shadow-sm text-gray-700 placeholder-gray-400 h-24 resize-none" placeholder="Describe freshness..." value={newProd.description} onChange={e => setNewProd({...newProd, description: e.target.value})} />
                                    <div className="border-2 border-dashed border-gray-200 rounded-[2rem] p-4 text-center hover:bg-green-50 transition-colors relative cursor-pointer">
                                        <div className="text-xs font-bold text-gray-500">{prodFile ? prodFile.name : (newProd.imageUrl ? "Change Image" : "üì∏ Upload Photo")}</div>
                                        <input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={(e) => setProdFile(e.target.files[0])} />
                                    </div>
                                    <div className="flex items-center gap-2 px-4"><input type="checkbox" checked={newProd.pesticides} onChange={e => setNewProd({...newProd, pesticides: e.target.checked})} className="w-5 h-5 rounded-md text-green-600 accent-green-600" /> <span className="text-sm font-bold text-gray-600">Pesticides used?</span></div>
                                    <div className="flex gap-2">
                                        {editingId && <BubbleButton variant="secondary" className="flex-1" onClick={() => { setEditingId(null); setNewProd({ name: '', price: '', stock: '', unit: 'kg', pesticides: false, description: '', farmAddress: '', state: '' }); }}>Cancel</BubbleButton>}
                                        <BubbleButton type="submit" className="flex-1" disabled={uploadingProd}>{uploadingProd ? 'Saving...' : 'Save'}</BubbleButton>
                                    </div>
                                </form>
                            </BubbleCard>
                            <div className="lg:col-span-2 space-y-4">
                                {products.filter(p => p.farmerId === currentUser.uid).map(p => (
                                    <div key={p.id} className="bg-white p-4 rounded-[2.5rem] shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all border border-transparent hover:border-green-100 flex items-center gap-6">
                                        <img src={p.imageUrl || "https://via.placeholder.com/150"} className="w-24 h-24 rounded-[2rem] object-cover bg-gray-100 shadow-inner" />
                                        <div className="flex-1 py-2">
                                            <div className="flex justify-between items-start">
                                                <h4 className="font-bold text-xl text-gray-800">{p.name}</h4>
                                                <span className={`text-[10px] font-black uppercase px-3 py-1 rounded-full ${p.status === 'approved' ? 'bg-green-100 text-green-700' : p.status === 'rejected' ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700'}`}>{p.status}</span>
                                            </div>
                                            <p className="text-sm text-gray-400 mb-2">‚Çπ{p.price}/{p.unit} ‚Ä¢ {p.stock} left</p>
                                            <div className="flex gap-2">
                                                <button onClick={() => { setNewProd(p); setEditingId(p.id); setProdFile(null); window.scrollTo({top:0, behavior:'smooth'}); }} className="p-2 bg-gray-100 rounded-full hover:bg-yellow-100 text-gray-500 hover:text-yellow-600 transition-colors"><Edit2 size={16}/></button>
                                                <button onClick={() => setDeleteConfirmId(p.id)} className="p-2 bg-gray-100 rounded-full hover:bg-red-100 text-gray-500 hover:text-red-600 transition-colors"><Trash2 size={16}/></button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                    {tab === 'orders' && (
                        <div className="grid gap-6">
                            {myOrders.map(o => (
                                <BubbleCard key={o.id} className="flex flex-col md:flex-row justify-between gap-6">
                                    <div>
                                        <h4 className="font-black text-gray-800 text-lg mb-1">Order #{o.id.slice(-6)}</h4>
                                        <p className="text-gray-400 text-sm mb-4">{new Date(o.date).toDateString()}</p>
                                        <div className="flex flex-col gap-1 text-sm text-gray-600">
                                            <span className="font-bold flex items-center gap-1"><User size={14}/> {o.delivery?.name}</span>
                                            <span className="flex items-center gap-1"><MapPin size={14}/> {o.delivery?.address}, {o.delivery?.city}</span>
                                        </div>
                                    </div>
                                    <div className="flex flex-col items-end gap-3">
                                        <div className="text-right">
                                            <div className="text-3xl font-black text-green-600">‚Çπ{o.total}</div>
                                            <div className={`text-xs font-bold uppercase px-3 py-1 rounded-full inline-block ${o.status === 'Accepted' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}`}>{o.status}</div>
                                        </div>
                                        {o.screenshotUrl && <a href={o.screenshotUrl} target="_blank" className="text-xs font-bold text-blue-500 bg-blue-50 px-3 py-1.5 rounded-full hover:bg-blue-100 transition-colors">View Payment Proof</a>}
                                    </div>
                                </BubbleCard>
                            ))}
                        </div>
                    )}
                    {tab === 'settings' && (
                        <BubbleCard className="max-w-md mx-auto text-center">
                            <h3 className="text-xl font-bold mb-6">Payment Details</h3>
                            <div className="space-y-4 mb-6">
                                <BubbleInput placeholder="UPI ID (e.g. name@bank)" value={upiId} onChange={e => setUpiId(e.target.value)} />
                                <div className="border-2 border-dashed border-gray-200 rounded-[2.5rem] p-8 relative group hover:bg-gray-50 transition-colors">
                                    {currentUser.qrCodeUrl ? <img src={currentUser.qrCodeUrl} className="w-40 h-40 mx-auto object-cover rounded-xl shadow-md"/> : <QrCode className="w-12 h-12 mx-auto text-gray-300"/>}
                                    <input type="file" id="qr-upload" className="absolute inset-0 opacity-0 cursor-pointer" />
                                    <p className="mt-4 text-xs font-bold text-gray-400">Click to upload QR Code</p>
                                </div>
                            </div>
                            <BubbleButton onClick={handleSavePayment} className="w-full">Save Changes</BubbleButton>
                        </BubbleCard>
                    )}
                </div>
              </div>
            );
          };

          const ModDashboard = () => {
             // ... Logic same as original ...
             const [pendingUsers, setPendingUsers] = useState([]);
             const [pendingProducts, setPendingProducts] = useState([]); 
             useEffect(() => {
                const u1 = onSnapshot(query(collection(db, "users"), where("status", "==", "pending")), s => setPendingUsers(s.docs.map(d => ({id: d.id, ...d.data()}))));
                const u2 = onSnapshot(query(collection(db, "products"), where("status", "==", "pending")), s => setPendingProducts(s.docs.map(d => ({id: d.id, ...d.data()}))));
                return () => { u1(); u2(); }
             }, []);

             return (
                 <div className="min-h-screen pt-28 pb-12 px-4 max-w-6xl mx-auto space-y-12">
                     <section>
                         <h2 className="text-3xl font-black text-gray-800 mb-6 pl-4 border-l-8 border-green-500">Farmer Approvals</h2>
                         <div className="grid gap-4">
                             {pendingUsers.map(u => (
                                 <BubbleCard key={u.id} className="flex flex-col md:flex-row justify-between items-center gap-6">
                                     <div>
                                         <h4 className="font-bold text-xl">{u.name}</h4>
                                         <p className="text-gray-500">{u.email} ‚Ä¢ {u.phone}</p>
                                         {u.docUrl && <a href={u.docUrl} target="_blank" className="text-blue-500 text-sm font-bold underline mt-2 block">View Documents</a>}
                                     </div>
                                     <div className="flex gap-2">
                                         <BubbleButton variant="danger" className="!px-4 !py-2" onClick={() => handleModAction(u.id, 'reject', 'Identity mismatch')}>Reject</BubbleButton>
                                         <BubbleButton variant="primary" className="!px-4 !py-2" onClick={() => handleModAction(u.id, 'approve')}>Approve</BubbleButton>
                                     </div>
                                 </BubbleCard>
                             ))}
                             {pendingUsers.length === 0 && <div className="text-center text-gray-400 py-8 bg-white/50 rounded-[2rem] border-2 border-dashed border-gray-200">All clear!</div>}
                         </div>
                     </section>
                     <section>
                        <h2 className="text-3xl font-black text-gray-800 mb-6 pl-4 border-l-8 border-orange-500">Product Approvals</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {pendingProducts.map(p => (
                                <BubbleCard key={p.id} className="p-6">
                                    <div className="flex items-start gap-4 mb-4">
                                        <img src={p.imageUrl || "https://via.placeholder.com/100"} className="w-16 h-16 rounded-2xl object-cover bg-gray-100"/>
                                        <div>
                                            <h4 className="font-bold text-gray-800 leading-tight">{p.name}</h4>
                                            <p className="text-xs text-gray-500 mt-1">by {p.farmerName}</p>
                                            <p className="font-black text-green-600 mt-1">‚Çπ{p.price}</p>
                                        </div>
                                    </div>
                                    <div className="flex gap-2 mt-4">
                                        <button onClick={() => handleProductApproval(p.id, 'reject', 'Policy violation')} className="flex-1 py-2 rounded-full bg-red-50 text-red-600 font-bold hover:bg-red-100 transition-colors">Reject</button>
                                        <button onClick={() => handleProductApproval(p.id, 'approve')} className="flex-1 py-2 rounded-full bg-green-50 text-green-600 font-bold hover:bg-green-100 transition-colors">Approve</button>
                                    </div>
                                </BubbleCard>
                            ))}
                            {pendingProducts.length === 0 && <div className="col-span-full text-center text-gray-400 py-8 bg-white/50 rounded-[2rem] border-2 border-dashed border-gray-200">No products pending.</div>}
                        </div>
                     </section>
                 </div>
             )
          };

          const Marketplace = () => {
             const [cart, setCart] = useState([]);
             const [search, setSearch] = useState("");
             const [modalItem, setModalItem] = useState(null);
             const [checkoutOpen, setCheckoutOpen] = useState(false);

             useEffect(() => { const s = localStorage.getItem('cart'); if(s) setCart(JSON.parse(s)); }, []);
             useEffect(() => { localStorage.setItem('cart', JSON.stringify(cart)); }, [cart]);

             const addToCart = (p) => {
                 if(Number(p.stock)<=0) return showNotification("Out of stock", "error");
                 setCart(prev => {
                    const ex = prev.find(i => i.id === p.id);
                    if(ex) return prev.map(i => i.id === p.id ? {...i, quantity: i.quantity+1} : i);
                    return [...prev, {...p, quantity: 1}];
                 });
                 showNotification("Added to basket!", "success");
             };

             const filtered = products.filter(p => p.status === 'approved' && p.name.toLowerCase().includes(search.toLowerCase()));

             return (
                 <div className="min-h-screen pt-28 pb-12 px-4 max-w-7xl mx-auto flex flex-col md:flex-row gap-8">
                     <div className="flex-1">
                         <div className="flex items-center gap-4 mb-8 bg-white p-2 rounded-full shadow-sm border border-gray-100">
                             <Search className="ml-4 text-gray-300"/>
                             <input className="w-full bg-transparent outline-none text-gray-700 font-medium placeholder-gray-300 h-10" placeholder="Search for fresh veggies..." value={search} onChange={e => setSearch(e.target.value)} />
                         </div>
                         <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                             {filtered.map(p => {
                                 const noStock = Number(p.stock) <= 0;
                                 return (
                                     <div key={p.id} className={`bg-white p-5 rounded-[2.5rem] shadow-sm hover:shadow-2xl transition-all duration-300 border border-transparent hover:border-green-100 group ${noStock ? 'opacity-60' : ''}`}>
                                         <div className="relative mb-4 overflow-hidden rounded-[2rem]">
                                             <img src={p.imageUrl} className="w-full h-48 object-cover transform group-hover:scale-110 transition-transform duration-500" onClick={() => setModalItem(p)}/>
                                             {noStock && <div className="absolute inset-0 bg-black/40 flex items-center justify-center text-white font-black text-xl backdrop-blur-sm">SOLD OUT</div>}
                                             {!noStock && <button onClick={() => addToCart(p)} className="absolute bottom-3 right-3 bg-white text-green-600 p-3 rounded-full shadow-lg hover:bg-green-600 hover:text-white transition-colors transform translate-y-12 group-hover:translate-y-0 duration-300"><ShoppingCart size={20}/></button>}
                                         </div>
                                         <h3 className="font-bold text-lg text-gray-800 mb-1">{p.name}</h3>
                                         <div className="flex justify-between items-center">
                                             <p className="text-xs text-gray-400 font-bold uppercase">{p.farmerName}</p>
                                             <p className="text-lg font-black text-green-600">‚Çπ{p.price}<span className="text-xs font-normal text-gray-400">/{p.unit}</span></p>
                                         </div>
                                     </div>
                                 );
                             })}
                         </div>
                     </div>
                     <div className="w-full md:w-96">
                         <BubbleCard className="sticky top-28 border-2 border-green-50">
                             <h3 className="text-xl font-bold mb-6 flex items-center gap-2">üõí Basket <span className="text-sm font-normal text-gray-400 ml-auto">{cart.length} items</span></h3>
                             {cart.length === 0 ? (
                                 <div className="text-center py-10 text-gray-300 font-bold text-sm">Basket is empty</div>
                             ) : (
                                 <div className="space-y-4 mb-6 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar">
                                     {cart.map((item, idx) => (
                                         <div key={idx} className="flex justify-between items-center bg-gray-50 p-3 rounded-2xl">
                                             <div className="flex items-center gap-3">
                                                 <div className="w-10 h-10 bg-white rounded-xl flex items-center justify-center font-bold text-xs text-gray-400 border border-gray-100">x{item.quantity}</div>
                                                 <div>
                                                     <p className="font-bold text-sm text-gray-700">{item.name}</p>
                                                     <p className="text-xs text-gray-400">‚Çπ{item.price * item.quantity}</p>
                                                 </div>
                                             </div>
                                             <button onClick={() => setCart(c => c.filter(i => i.id !== item.id))} className="text-red-300 hover:text-red-500"><XCircle size={18}/></button>
                                         </div>
                                     ))}
                                 </div>
                             )}
                             {cart.length > 0 && (
                                 <>
                                     <div className="flex justify-between text-xl font-black text-gray-800 mb-6 px-2">
                                         <span>Total</span>
                                         <span>‚Çπ{cart.reduce((s,i)=>s+(i.price*i.quantity),0)}</span>
                                     </div>
                                     <BubbleButton onClick={() => setCheckoutOpen(true)} className="w-full shadow-xl shadow-green-200">Checkout Now</BubbleButton>
                                 </>
                             )}
                         </BubbleCard>
                     </div>
                     
                     {/* Product Detail Modal */}
                     {modalItem && (
                         <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-green-900/20 backdrop-blur-sm" onClick={() => setModalItem(null)}>
                             <BubbleCard className="max-w-lg w-full p-0 overflow-hidden relative" onClick={e => e.stopPropagation()}>
                                 <img src={modalItem.imageUrl} className="w-full h-64 object-cover"/>
                                 <button onClick={() => setModalItem(null)} className="absolute top-4 right-4 bg-white/80 p-2 rounded-full backdrop-blur-md"><X size={20}/></button>
                                 <div className="p-8">
                                     <div className="flex justify-between items-start mb-4">
                                         <h2 className="text-3xl font-black text-gray-800">{modalItem.name}</h2>
                                         <span className="text-2xl font-bold text-green-600">‚Çπ{modalItem.price}<span className="text-sm text-gray-400">/{modalItem.unit}</span></span>
                                     </div>
                                     <p className="text-gray-500 mb-6 leading-relaxed">{modalItem.description || "No description."}</p>
                                     <div className="flex gap-2 mb-8">
                                         {modalItem.pesticides ? <span className="bg-red-50 text-red-600 px-3 py-1 rounded-full text-xs font-bold">Contains Pesticides</span> : <span className="bg-green-50 text-green-600 px-3 py-1 rounded-full text-xs font-bold">Organic / Pesticide Free</span>}
                                         <span className="bg-blue-50 text-blue-600 px-3 py-1 rounded-full text-xs font-bold">{modalItem.stock} in stock</span>
                                     </div>
                                     <BubbleButton className="w-full" onClick={() => { addToCart(modalItem); setModalItem(null); }} disabled={Number(modalItem.stock)<=0}>Add to Basket</BubbleButton>
                                 </div>
                             </BubbleCard>
                         </div>
                     )}

                     {checkoutOpen && (
                         <CheckoutModal cart={cart} onClose={() => setCheckoutOpen(false)} onConfirm={placeOrder} />
                     )}
                 </div>
             )
          };

          const CheckoutModal = ({ cart, onClose, onConfirm }) => {
              // ... Simplified checkout logic adapt to bubble ...
              const [delivery, setDelivery] = useState({ name: currentUser?.name||'', email: currentUser?.email||'', phone: currentUser?.phone||'', address: currentUser?.address||'', city: '', zip: '' });
              const [screen, setScreen] = useState(null);
              const [uploading, setUploading] = useState(false);
              const total = cart.reduce((a,b) => a + (b.price*b.quantity), 0) + 60; // Flat delivery

              const handleSubmit = async () => {
                  if(!screen) return alert("Upload payment screenshot");
                  setUploading(true);
                  try {
                    const url = await uploadToCloudinary(screen);
                    // Group by farmer for simplicity in this demo view, we just send one order object per farmer ideally, 
                    // but keeping it simple:
                    await onConfirm({ items: cart, delivery, total, subtotal: total-60, deliveryFee: 60, screenshotUrl: url });
                    onClose();
                  } catch(e) { console.error(e); } finally { setUploading(false); }
              };

              return (
                  <div className="fixed inset-0 z-[70] flex items-center justify-center p-4 bg-green-900/30 backdrop-blur-md">
                      <BubbleCard className="max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                          <h2 className="text-2xl font-black mb-6">Checkout</h2>
                          <div className="grid md:grid-cols-2 gap-6">
                              <div className="space-y-4">
                                  <h4 className="font-bold text-gray-400 text-sm uppercase">Shipping</h4>
                                  <BubbleInput placeholder="Name" value={delivery.name} onChange={e => setDelivery({...delivery, name: e.target.value})} />
                                  <BubbleInput placeholder="Address" value={delivery.address} onChange={e => setDelivery({...delivery, address: e.target.value})} />
                                  <div className="grid grid-cols-2 gap-3">
                                      <BubbleInput placeholder="City" value={delivery.city} onChange={e => setDelivery({...delivery, city: e.target.value})} />
                                      <BubbleInput placeholder="ZIP" value={delivery.zip} onChange={e => setDelivery({...delivery, zip: e.target.value})} />
                                  </div>
                              </div>
                              <div className="space-y-4">
                                  <h4 className="font-bold text-gray-400 text-sm uppercase">Payment (Total: ‚Çπ{total})</h4>
                                  <div className="bg-gray-50 p-6 rounded-[2rem] text-center border-2 border-dashed border-gray-200">
                                      <p className="text-sm font-bold text-gray-500 mb-2">Scan QR code from seller list or pay via UPI</p>
                                      <div className="text-xs text-gray-400 mb-4">Upload Screenshot of Payment</div>
                                      <input type="file" onChange={e => setScreen(e.target.files[0])} />
                                  </div>
                              </div>
                          </div>
                          <div className="mt-8 flex gap-4">
                              <BubbleButton variant="secondary" onClick={onClose} className="flex-1">Cancel</BubbleButton>
                              <BubbleButton onClick={handleSubmit} disabled={uploading} className="flex-1">{uploading ? 'Processing...' : 'Confirm Order'}</BubbleButton>
                          </div>
                      </BubbleCard>
                  </div>
              )
          };

          const Hero = () => (
             <div className="relative pt-40 pb-20 overflow-hidden">
                 <div className="absolute top-0 right-0 w-2/3 h-full bg-gradient-to-l from-green-100 to-transparent rounded-l-[10rem] -z-10 opacity-60"></div>
                 <div className="max-w-7xl mx-auto px-6 flex flex-col lg:flex-row items-center gap-12">
                     <div className="flex-1 space-y-6">
                         <div className="inline-flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow-sm text-green-600 font-bold text-xs uppercase tracking-wide border border-green-50 animate-bounce">
                             <Sparkles size={14}/> Fresh Harvest Today
                         </div>
                         <h1 className="text-6xl md:text-7xl font-black text-gray-800 leading-[1.1] tracking-tight">
                             Eat Fresh. <br/>
                             <span className="text-transparent bg-clip-text bg-gradient-to-r from-green-500 to-lime-500">Live Better.</span>
                         </h1>
                         <p className="text-xl text-gray-500 max-w-lg leading-relaxed">
                             Direct from the soil to your kitchen. No middlemen, just pure, organic goodness grown by your neighbors.
                         </p>
                         <div className="flex gap-4 pt-4">
                             <BubbleButton onClick={() => setView('marketplace')} className="shadow-xl shadow-green-200">Start Shopping</BubbleButton>
                             <BubbleButton variant="secondary" onClick={() => setView('about')}>Our Story</BubbleButton>
                         </div>
                     </div>
                     <div className="flex-1 relative">
                         <div className="relative z-10 bg-white/60 backdrop-blur-xl p-8 rounded-[3rem] shadow-2xl shadow-green-900/10 border border-white/50 transform rotate-2 hover:rotate-0 transition-all duration-500">
                             <div className="flex items-center justify-between mb-6">
                                 <h3 className="font-bold text-2xl text-gray-800">Fresh Picks</h3>
                                 <div className="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                             </div>
                             <div className="space-y-4">
                                 {products.slice(0,3).map((p,i) => (
                                     <div key={i} className="flex items-center gap-4 bg-white p-3 rounded-[1.5rem] shadow-sm">
                                         <div className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center text-xl">ü•¨</div>
                                         <div className="flex-1">
                                             <div className="font-bold text-gray-800">{p.name}</div>
                                             <div className="text-xs text-gray-400">‚Çπ{p.price}/{p.unit}</div>
                                         </div>
                                         <button className="w-8 h-8 bg-black text-white rounded-full flex items-center justify-center hover:scale-110 transition-transform"><ShoppingCart size={14}/></button>
                                     </div>
                                 ))}
                                 {products.length === 0 && <div className="text-center py-4 text-gray-400 text-sm">Loading market data...</div>}
                             </div>
                         </div>
                         {/* Floating bubbles */}
                         <div className="absolute -top-10 -right-10 w-32 h-32 bg-lime-300 rounded-full mix-blend-multiply filter blur-xl opacity-50 animate-blob"></div>
                         <div className="absolute -bottom-10 -left-10 w-32 h-32 bg-green-300 rounded-full mix-blend-multiply filter blur-xl opacity-50 animate-blob animation-delay-2000"></div>
                     </div>
                 </div>
             </div>
          );

          if (loading) return <div className="min-h-screen flex items-center justify-center bg-[#f0fdf4]"><Loader2 className="w-12 h-12 animate-spin text-green-500" /></div>;

          return (
            <div className="min-h-screen flex flex-col font-sans text-gray-800">
               <Navbar />
               {notification && (
                   <div className={`fixed bottom-6 right-6 z-[100] px-8 py-4 rounded-full text-white font-bold shadow-2xl animate-in slide-in-from-bottom-10 flex items-center gap-3 ${notification.type === 'error' ? 'bg-red-500 shadow-red-200' : 'bg-green-600 shadow-green-200'}`}>
                       {notification.type === 'error' ? <AlertCircle size={20}/> : <CheckCircle size={20}/>}
                       {notification.msg}
                   </div>
               )}
               <main className="flex-grow">
                 {view === 'home' && <Hero />}
                 {view === 'about' && <AboutUs />}
                 {view === 'auth' && <AuthScreen />}
                 {view === 'farmer-panel' && <FarmerDashboard />}
                 {view === 'mod-panel' && <ModDashboard />}
                 {view === 'marketplace' && <Marketplace />}
               </main>
               <footer className="bg-white border-t border-green-50 py-12 mt-20">
                   <div className="max-w-7xl mx-auto px-6 text-center">
                       <div className="flex justify-center items-center gap-2 mb-6 opacity-50 grayscale hover:grayscale-0 transition-all">
                           <Leaf size={24} className="text-green-600"/>
                           <span className="text-xl font-black tracking-tight">Farm2Home</span>
                       </div>
                       <p className="text-gray-400 text-sm">¬© 2024 Farm2Home Platform. Cultivated with <Heart className="inline w-3 h-3 text-red-400 fill-current"/> for better living.</p>
                   </div>
               </footer>
            </div>
          );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    <style>
      @keyframes blob {
        0% { transform: translate(0px, 0px) scale(1); }
        33% { transform: translate(30px, -50px) scale(1.1); }
        66% { transform: translate(-20px, 20px) scale(0.9); }
        100% { transform: translate(0px, 0px) scale(1); }
      }
      .animate-blob { animation: blob 7s infinite; }
      .animation-delay-2000 { animation-delay: 2s; }
      .custom-scrollbar::-webkit-scrollbar { width: 6px; }
      .custom-scrollbar::-webkit-scrollbar-thumb { background: #dcfce7; border-radius: 10px; }
    </style>
</body>
</html>
