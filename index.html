<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farm2Home - Fresh Produce</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Import Map: Switched to Google's official CDN to fix auth registration error -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js",
        "firebase/storage": "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js"
      }
    }
    </script>
</head>
<body class="bg-white">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
          Leaf, Truck, ShieldCheck, Heart, Search, ShoppingCart, 
          User, ChevronRight, ArrowRight, Menu, X, MapPin, Star, 
          Facebook, Twitter, Instagram, Upload, FileText, CheckCircle, 
          XCircle, AlertCircle, Package, DollarSign, Users, ClipboardList, Loader2
        } from 'lucide-react';

        // --- FIREBASE IMPORTS ---
        import { initializeApp } from 'firebase/app';
        import { 
          getAuth, 
          createUserWithEmailAndPassword, 
          signInWithEmailAndPassword, 
          signOut, 
          onAuthStateChanged 
        } from 'firebase/auth';
        import { 
          getFirestore, 
          collection, 
          addDoc, 
          getDocs, 
          doc, 
          setDoc, 
          getDoc, 
          updateDoc, 
          onSnapshot, 
          query, 
          where,
          serverTimestamp,
          limit,
          orderBy 
        } from 'firebase/firestore';
        import { 
          getStorage, 
          ref, 
          uploadBytes, 
          getDownloadURL 
        } from 'firebase/storage';

        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
          apiKey: "AIzaSyCTV6gg2QXLHJMSGvOWIa-YDy5-PvrgeHk",
          authDomain: "farm2home-2f7ff.firebaseapp.com",
          projectId: "farm2home-2f7ff",
          storageBucket: "farm2home-2f7ff.firebasestorage.app",
          messagingSenderId: "656644623315",
          appId: "1:656644623315:web:0d59d865c82b5c9b4e7d26",
          measurementId: "G-XFQFK8Q9TZ"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // --- CONSTANTS ---
        const FEATURES = [
          { 
            title: '100% Organic', 
            icon: <Leaf className="w-8 h-8 text-green-600" />, 
            bgColor: 'bg-green-100', 
            description: 'All our products are certified organic and grown without harmful pesticides.' 
          },
          { 
            title: 'Fast Delivery', 
            icon: <Truck className="w-8 h-8 text-blue-600" />, 
            bgColor: 'bg-blue-100', 
            description: 'Same-day delivery available for orders placed before noon in local areas.' 
          },
          { 
            title: 'Quality Assured', 
            icon: <ShieldCheck className="w-8 h-8 text-purple-600" />, 
            bgColor: 'bg-purple-100', 
            description: 'Every product is hand-picked and inspected to ensure premium quality.' 
          },
          { 
            title: 'Support Local', 
            icon: <Heart className="w-8 h-8 text-red-600" />, 
            bgColor: 'bg-red-100', 
            description: 'Buy directly from farmers and support your local agricultural community.' 
          },
        ];

        function App() {
          // --- GLOBAL STATE ---
          const [products, setProducts] = useState([]); 
          const [currentUser, setCurrentUser] = useState(null);
          const [loading, setLoading] = useState(true);
          
          // Navigation & UI State
          const [view, setView] = useState('home'); 
          const [authMode, setAuthMode] = useState('login'); 
          const [isMenuOpen, setIsMenuOpen] = useState(false);
          const [notification, setNotification] = useState(null);

          // --- AUTH LISTENER ---
          useEffect(() => {
            const unsubscribe = onAuthStateChanged(auth, async (user) => {
              if (user) {
                // Fetch extra user details from Firestore
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                  setCurrentUser({ uid: user.uid, ...userDoc.data() });
                  if(view === 'home' || view === 'auth') setView('home'); // Go to home by default
                }
              } else {
                setCurrentUser(null);
              }
              setLoading(false);
            });
            return () => unsubscribe();
          }, []);

          // --- DATA LISTENERS ---
          useEffect(() => {
            // Listen for Products
            const q = query(collection(db, "products"));
            const unsubscribeProducts = onSnapshot(q, (snapshot) => {
              const productsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
              setProducts(productsData);
            });

            return () => unsubscribeProducts();
          }, []);

          // --- ACTIONS ---

          const showNotification = (msg, type) => {
            setNotification({ msg, type });
            setTimeout(() => setNotification(null), 3000);
          };

          const handleSignup = async (formData, file) => {
            setLoading(true);
            try {
              // 1. Create Auth User
              const userCredential = await createUserWithEmailAndPassword(auth, formData.email, formData.password);
              const user = userCredential.user;
              
              let docUrl = "";

              // 2. Upload Document if provided
              if (file) {
                const storageRef = ref(storage, `documents/${user.uid}/${file.name}`);
                await uploadBytes(storageRef, file);
                docUrl = await getDownloadURL(storageRef);
              }

              // 3. Save User Profile to Firestore
              const userData = {
                name: formData.name,
                email: formData.email,
                phone: formData.phone || "",
                address: formData.address || "",
                role: formData.role,
                status: (formData.role === 'farmer' || formData.role === 'mod') ? 'pending' : 'active',
                aadhar: formData.aadhar || "",
                docUrl: docUrl,
                joinedDate: serverTimestamp(),
                rejectionReason: null
              };

              await setDoc(doc(db, "users", user.uid), userData);

              showNotification("Account created successfully!", "success");
              
              if (userData.status === 'pending') {
                setView('home'); // or show a specific pending message
                alert("Application submitted! Please wait for approval.");
              }

            } catch (error) {
              console.error(error);
              showNotification(error.message, "error");
            } finally {
              setLoading(false);
            }
          };

          const handleLogin = async (email, password) => {
            setLoading(true);
            try {
              await signInWithEmailAndPassword(auth, email, password);
              showNotification("Logged in successfully", "success");
            } catch (error) {
              showNotification("Invalid email or password", "error");
            } finally {
              setLoading(false);
            }
          };

          const handleLogout = async () => {
            await signOut(auth);
            setView('home');
          };

          const addProduct = async (productData) => {
            if (!currentUser) return;
            try {
              await addDoc(collection(db, "products"), {
                ...productData,
                farmerId: currentUser.uid,
                farmerName: currentUser.name,
                createdAt: serverTimestamp()
              });
              showNotification("Product published!", "success");
            } catch (error) {
              showNotification("Error adding product", "error");
            }
          };

          const placeOrder = async (cartItems, total) => {
            if (!currentUser) return;
            try {
              // 1. Create Order
              await addDoc(collection(db, "orders"), {
                customerId: currentUser.uid,
                customerName: currentUser.name,
                items: cartItems,
                total: total,
                date: new Date().toISOString(),
                status: 'Paid',
                address: currentUser.address || 'Local'
              });

              // 2. Update Stock (Simple version - ideally run as transaction)
              for (const item of cartItems) {
                const prodRef = doc(db, "products", item.id);
                // We need to fetch current stock first to be safe, but for now simple update
                // Note: In a real app, use transactions to prevent race conditions
                const prodSnap = await getDoc(prodRef);
                if (prodSnap.exists()) {
                   const currentStock = prodSnap.data().stock;
                   await updateDoc(prodRef, { stock: currentStock - item.quantity });
                }
              }

              showNotification("Order placed successfully!", "success");
            } catch (error) {
              console.error(error);
              showNotification("Failed to place order", "error");
            }
          };

          const handleModAction = async (userId, action, reason = "") => {
            try {
              const userRef = doc(db, "users", userId);
              await updateDoc(userRef, {
                status: action === 'approve' ? 'active' : 'rejected',
                rejectionReason: reason
              });
              showNotification(`User ${action === 'approve' ? 'approved' : 'rejected'}`, "success");
            } catch (error) {
              showNotification("Action failed", "error");
            }
          };

          // --- COMPONENTS ---

          const Navbar = () => (
            <nav className="fixed top-0 left-0 right-0 bg-white/95 backdrop-blur-md z-50 border-b border-gray-100 h-20">
              <div className="max-w-7xl mx-auto px-4 h-full flex justify-between items-center">
                <div 
                  className="flex items-center gap-2 cursor-pointer group"
                  onClick={() => setView('home')}
                >
                  <div className="bg-green-600 p-2 rounded-lg group-hover:scale-110 transition-transform">
                    <Leaf className="text-white w-6 h-6" />
                  </div>
                  <span className="text-2xl font-black text-gray-900 tracking-tight">Farm<span className="text-green-600">2</span>Home</span>
                </div>

                <div className="hidden md:flex items-center gap-8 font-medium">
                   <button onClick={() => setView('home')} className={`hover:text-green-600 transition-colors ${view === 'home' ? 'text-green-600' : 'text-gray-600'}`}>Home</button>
                   <button onClick={() => setView('marketplace')} className={`hover:text-green-600 transition-colors ${view === 'marketplace' ? 'text-green-600' : 'text-gray-600'}`}>Marketplace</button>
                   <button onClick={() => setView('about')} className={`hover:text-green-600 transition-colors ${view === 'about' ? 'text-green-600' : 'text-gray-600'}`}>About Us</button>
                </div>

                <div className="hidden md:flex items-center gap-4">
                  {!currentUser ? (
                    <>
                      <button onClick={() => { setView('auth'); setAuthMode('login'); }} className="text-gray-600 font-bold hover:text-green-700">Sign In</button>
                      <button 
                        onClick={() => { setView('auth'); setAuthMode('signup'); }}
                        className="px-5 py-2.5 bg-green-700 text-white font-semibold rounded-xl hover:bg-green-800 transition-all shadow-lg shadow-green-100"
                      >
                        Get Started
                      </button>
                    </>
                  ) : (
                    <div className="flex items-center gap-4">
                      <span className="text-sm font-medium text-gray-500 bg-gray-50 px-3 py-1 rounded-lg">
                        {currentUser.name} • <span className="text-green-700 uppercase font-bold">{currentUser.role}</span>
                      </span>
                      {currentUser.role !== 'buyer' && (
                        <button onClick={() => setView('dashboard')} className="text-gray-900 font-bold hover:text-green-700">Dashboard</button>
                      )}
                      <button 
                        onClick={handleLogout}
                        className="px-4 py-2 border border-gray-200 rounded-xl hover:bg-gray-50 font-bold text-sm text-red-500 hover:border-red-200"
                      >
                        Logout
                      </button>
                    </div>
                  )}
                </div>
                
                <button className="md:hidden" onClick={() => setIsMenuOpen(!isMenuOpen)}>
                  {isMenuOpen ? <X /> : <Menu />}
                </button>
              </div>
            </nav>
          );

          const AboutUs = () => (
            <section className="py-32 bg-white">
              <div className="max-w-4xl mx-auto px-4 text-center">
                <div className="inline-block bg-green-100 text-green-800 px-4 py-1.5 rounded-full text-sm font-bold tracking-wide uppercase mb-6">Our Mission</div>
                <h2 className="text-5xl font-black text-gray-900 mb-8">Bringing Freshness Home</h2>
                <div className="prose prose-lg mx-auto text-gray-500 space-y-8 text-lg leading-relaxed">
                  <p>
                    At <span className="text-green-700 font-bold">Farm2Home</span>, we believe that access to nutritious, chemical-free vegetables should be effortless for everyone. We noticed a disconnect—people want to eat healthy, but finding high-quality, affordable produce can be a challenge.
                  </p>
                  <p>
                    Simultaneously, local farmers struggle to find fair markets for their harvest. We created this platform to solve both problems at once.
                  </p>
                  <div className="bg-gray-50 p-8 rounded-3xl border border-gray-100 my-12">
                    <h3 className="text-2xl font-bold text-gray-900 mb-4">Empowering The Roots</h3>
                    <p>
                      We provide a robust digital marketplace where farmers can list their produce, set their own prices, and connect directly with buyers. No middlemen, no hidden fees—just pure, honest trade that puts money back into the pockets of those who feed us.
                    </p>
                  </div>
                  <p>
                    By making vegetable access easy and transparent, we are building a healthier community and a sustainable future for agriculture.
                  </p>
                </div>
              </div>
            </section>
          );

          const FeaturesSection = () => (
            <section className="py-24 bg-white">
              <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div className="text-center max-w-3xl mx-auto mb-20 space-y-4">
                  <h2 className="text-4xl font-bold text-gray-900 tracking-tight">Why Choose Farm2Home?</h2>
                  <p className="text-gray-500 text-lg">We bridge the gap between rural farmers and urban consumers through a transparent, high-quality supply chain.</p>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-10">
                  {FEATURES.map((feature, idx) => (
                    <div key={idx} className="group p-8 rounded-[32px] hover:bg-gray-50 transition-all border border-transparent hover:border-gray-100">
                      <div className={`${feature.bgColor} w-16 h-16 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform`}>
                        {feature.icon}
                      </div>
                      <h3 className="text-xl font-bold text-gray-900 mb-3">{feature.title}</h3>
                      <p className="text-gray-500 leading-relaxed text-sm">{feature.description}</p>
                    </div>
                  ))}
                </div>
              </div>
            </section>
          );

          const Footer = () => (
            <footer className="bg-gray-900 text-gray-400 pt-24 pb-12 mt-auto">
              <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-16">
                  <div className="space-y-6">
                    <div className="flex items-center gap-2">
                      <div className="bg-green-600 p-2 rounded-lg">
                        <Leaf className="text-white w-5 h-5" />
                      </div>
                      <span className="text-2xl font-black text-white">Farm<span className="text-green-500">2</span>Home</span>
                    </div>
                    <p className="leading-relaxed">Connecting local communities through fresh, sustainable, and organic farm produce directly to your doorstep.</p>
                  </div>
                  <div>
                    <h4 className="text-white font-bold text-lg mb-6">Quick Links</h4>
                    <ul className="space-y-4">
                      <li><button className="hover:text-green-500 transition-colors">Find Local Farms</button></li>
                      <li><button className="hover:text-green-500 transition-colors">Seasonal Calendar</button></li>
                      <li><button className="hover:text-green-500 transition-colors">Become a Seller</button></li>
                    </ul>
                  </div>
                  <div>
                    <h4 className="text-white font-bold text-lg mb-6">Support</h4>
                    <ul className="space-y-4">
                      <li><button className="hover:text-green-500 transition-colors">Shipping Policy</button></li>
                      <li><button className="hover:text-green-500 transition-colors">Privacy Policy</button></li>
                      <li><button className="hover:text-green-500 transition-colors">Contact Us</button></li>
                    </ul>
                  </div>
                  <div>
                    <h4 className="text-white font-bold text-lg mb-6">Newsletter</h4>
                    <p className="mb-4 text-sm">Join our mailing list for weekly fresh offers and farm news.</p>
                    <div className="relative">
                      <input type="email" placeholder="Email address" className="w-full bg-gray-800 border-none rounded-xl px-5 py-4 focus:ring-2 focus:ring-green-500 text-white" />
                      <button className="absolute right-2 top-2 bottom-2 bg-green-600 hover:bg-green-700 text-white px-4 rounded-lg transition-colors font-bold">
                        Join
                      </button>
                    </div>
                  </div>
                </div>
                <div className="pt-12 border-t border-gray-800 text-center text-sm">
                  &copy; {new Date().getFullYear()} Farm2Home Platform. All rights reserved.
                </div>
              </div>
            </footer>
          );

          const AuthScreen = () => {
            const [role, setRole] = useState('buyer'); 
            const [file, setFile] = useState(null);
            const [formData, setFormData] = useState({
              name: '', email: '', password: '', phone: '', address: '', aadhar: ''
            });

            const handleSubmit = (e) => {
              e.preventDefault();
              if (authMode === 'login') {
                handleLogin(formData.email, formData.password);
              } else {
                handleSignup({ ...formData, role }, file);
              }
            };

            return (
              <div className="min-h-screen pt-20 flex bg-white">
                {/* Left Side - Image */}
                <div className="hidden lg:flex w-1/2 bg-green-900 relative items-center justify-center overflow-hidden">
                  <div className="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1542838132-92c53300491e?auto=format&fit=crop&q=80')] bg-cover bg-center opacity-40 mix-blend-overlay"></div>
                  <div className="absolute inset-0 bg-gradient-to-t from-green-900/90 to-transparent"></div>
                  <div className="relative z-10 p-16 text-white max-w-xl">
                     <div className="flex items-center gap-3 mb-8">
                       <div className="bg-white/20 p-3 rounded-2xl backdrop-blur-sm">
                         <Leaf className="w-8 h-8 text-white" />
                       </div>
                       <span className="text-3xl font-black tracking-tight">Farm2Home</span>
                     </div>
                     <h1 className="text-5xl font-bold mb-6 leading-tight">
                       {authMode === 'login' ? 'Welcome Back to Freshness.' : 'Start Your Journey to Better Eating.'}
                     </h1>
                     <p className="text-xl text-green-100/80 leading-relaxed mb-8">
                       Join a community dedicated to sustainable farming, fair prices, and the healthiest produce for your family.
                     </p>
                     <div className="flex gap-4">
                       <div className="flex -space-x-4">
                         <div className="w-12 h-12 rounded-full border-4 border-green-900 bg-white/20 flex items-center justify-center">
                            <Users className="w-6 h-6"/>
                         </div>
                       </div>
                       <div className="flex flex-col justify-center">
                         <span className="font-bold">Join the Community</span>
                         <span className="text-sm text-green-200">Start today</span>
                       </div>
                     </div>
                  </div>
                </div>

                {/* Right Side - Form */}
                <div className="w-full lg:w-1/2 flex items-center justify-center p-8 lg:p-16 overflow-y-auto">
                  <div className="w-full max-w-md space-y-8">
                    <div className="text-center lg:text-left">
                      <h2 className="text-4xl font-black text-gray-900 mb-2">
                        {authMode === 'login' ? 'Sign In' : 'Create Account'}
                      </h2>
                      <p className="text-gray-500">
                        {authMode === 'login' ? 'Access your dashboard to manage orders.' : 'Select your role to get started.'}
                      </p>
                    </div>

                    {authMode === 'signup' && (
                      <div className="grid grid-cols-2 gap-2 p-1 bg-gray-100 rounded-2xl">
                        {['buyer', 'farmer'].map((r) => (
                          <button
                            type="button"
                            key={r}
                            onClick={() => setRole(r)}
                            className={`py-3 text-sm font-bold rounded-xl capitalize transition-all duration-200 ${role === r ? 'bg-white text-green-700 shadow-md transform scale-100' : 'text-gray-500 hover:text-gray-700'}`}
                          >
                            {r}
                          </button>
                        ))}
                      </div>
                    )}

                    <form onSubmit={handleSubmit} className="space-y-5">
                      {authMode === 'signup' && (
                        <div className="grid grid-cols-2 gap-4">
                          <div className="space-y-1">
                            <label className="text-xs font-bold text-gray-700 ml-1 uppercase">Full Name</label>
                            <input required placeholder="John Doe" className="w-full px-5 py-4 rounded-xl bg-gray-50 border border-gray-100 focus:border-green-500 focus:bg-white focus:ring-4 focus:ring-green-100 transition-all outline-none" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />
                          </div>
                          <div className="space-y-1">
                            <label className="text-xs font-bold text-gray-700 ml-1 uppercase">Phone</label>
                            <input required placeholder="+1 234..." className="w-full px-5 py-4 rounded-xl bg-gray-50 border border-gray-100 focus:border-green-500 focus:bg-white focus:ring-4 focus:ring-green-100 transition-all outline-none" value={formData.phone} onChange={e => setFormData({...formData, phone: e.target.value})} />
                          </div>
                        </div>
                      )}
                      
                      <div className="space-y-1">
                        <label className="text-xs font-bold text-gray-700 ml-1 uppercase">Email Address</label>
                        <input required type="email" placeholder="name@example.com" className="w-full px-5 py-4 rounded-xl bg-gray-50 border border-gray-100 focus:border-green-500 focus:bg-white focus:ring-4 focus:ring-green-100 transition-all outline-none" value={formData.email} onChange={e => setFormData({...formData, email: e.target.value})} />
                      </div>

                      <div className="space-y-1">
                        <label className="text-xs font-bold text-gray-700 ml-1 uppercase">Password</label>
                        <input required type="password" placeholder="••••••••" className="w-full px-5 py-4 rounded-xl bg-gray-50 border border-gray-100 focus:border-green-500 focus:bg-white focus:ring-4 focus:ring-green-100 transition-all outline-none" value={formData.password} onChange={e => setFormData({...formData, password: e.target.value})} />
                      </div>

                      {/* Farmer Specific Fields */}
                      {authMode === 'signup' && role === 'farmer' && (
                        <div className="bg-green-50/50 p-6 rounded-2xl border border-green-100 space-y-4 animate-in slide-in-from-top-4 fade-in">
                          <div className="flex items-center gap-2 text-green-800 font-bold mb-2">
                            <ShieldCheck className="w-5 h-5" />
                            Govt. Verification Required
                          </div>
                          <input required placeholder="Aadhar / Govt ID Number" className="w-full px-5 py-4 rounded-xl bg-white border border-green-100 focus:border-green-500 focus:ring-4 focus:ring-green-100 transition-all outline-none" value={formData.aadhar} onChange={e => setFormData({...formData, aadhar: e.target.value})} />
                          <div className="border-2 border-dashed border-green-200 rounded-xl p-6 text-center bg-white cursor-pointer hover:bg-green-50 hover:border-green-400 transition-all group relative">
                            <div className="bg-green-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                              <Upload className="w-6 h-6 text-green-600" />
                            </div>
                            <span className="text-sm font-bold text-gray-700">{file ? file.name : "Click to upload ID Document"}</span>
                            <p className="text-xs text-gray-400 mt-1">Supports JPG, PNG, PDF</p>
                            <input 
                              type="file" 
                              required
                              className="absolute inset-0 opacity-0 cursor-pointer w-full h-full" 
                              onChange={(e) => {
                                console.log("File selected:", e.target.files[0]);
                                setFile(e.target.files[0]);
                              }}
                            />
                          </div>
                        </div>
                      )}

                      {/* Address for everyone */}
                      {authMode === 'signup' && (
                         <div className="space-y-1">
                           <label className="text-xs font-bold text-gray-700 ml-1 uppercase">Address</label>
                           <input required placeholder="123 Farm Road, Valley State" className="w-full px-5 py-4 rounded-xl bg-gray-50 border border-gray-100 focus:border-green-500 focus:bg-white focus:ring-4 focus:ring-green-100 transition-all outline-none" value={formData.address} onChange={e => setFormData({...formData, address: e.target.value})} />
                         </div>
                      )}

                      <button disabled={loading} className="w-full py-4 bg-green-700 text-white font-bold text-lg rounded-xl hover:bg-green-800 transition-all shadow-xl shadow-green-200 hover:shadow-2xl hover:-translate-y-1 active:scale-95 mt-6 disabled:opacity-50 disabled:cursor-not-allowed flex justify-center">
                        {loading ? <Loader2 className="animate-spin" /> : (authMode === 'login' ? 'Sign In' : 'Create Account')}
                      </button>
                    </form>

                    <div className="text-center pt-4">
                      <button 
                        onClick={() => { setAuthMode(authMode === 'login' ? 'signup' : 'login'); setFile(null); }}
                        className="text-gray-500 font-medium hover:text-green-700 transition-colors"
                      >
                        {authMode === 'login' ? "Don't have an account? " : "Already have an account? "}
                        <span className="font-bold underline text-gray-900">{authMode === 'login' ? 'Sign Up' : 'Sign In'}</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            );
          };

          const FarmerDashboard = () => {
            const [tab, setTab] = useState('inventory'); // inventory, orders, status
            const [newProd, setNewProd] = useState({ name: '', price: '', stock: '', unit: 'kg', pesticides: false, description: '' });
            const [myOrders, setMyOrders] = useState([]);

            // Fetch Farmer Orders
            useEffect(() => {
              if (tab === 'orders') {
                const q = query(collection(db, "orders"));
                const unsubscribe = onSnapshot(q, (snapshot) => {
                  // Client-side filter for orders containing this farmer's products
                  // Ideally done with better backend structure or array-contains query
                  const allOrders = snapshot.docs.map(d => ({id: d.id, ...d.data()}));
                  const relevantOrders = allOrders.filter(o => o.items.some(i => i.farmerId === currentUser.uid));
                  // Map items to only show relevant ones
                  const mappedOrders = relevantOrders.map(o => ({
                     ...o,
                     items: o.items.filter(i => i.farmerId === currentUser.uid)
                  }));
                  setMyOrders(mappedOrders);
                });
                return () => unsubscribe();
              }
            }, [tab, currentUser.uid]);

            // Status Check
            if (currentUser.status === 'pending') {
              return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 bg-gray-50 text-center">
                  <div className="bg-white p-12 rounded-[32px] shadow-xl max-w-lg w-full border border-gray-100">
                    <div className="bg-yellow-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-8 animate-pulse">
                      <ClipboardList className="w-12 h-12 text-yellow-600" />
                    </div>
                    <h2 className="text-3xl font-black mb-4 text-gray-900">Application Under Review</h2>
                    <p className="text-gray-500 mb-8 leading-relaxed">Your documents are currently being reviewed by our moderation team. You will be notified via email once approved.</p>
                    <div className="p-6 bg-gray-50 rounded-2xl text-left text-sm text-gray-600 space-y-3 border border-gray-100">
                      <div className="flex justify-between border-b border-gray-200 pb-2"><span>Applicant Name</span> <span className="font-bold text-gray-900">{currentUser.name}</span></div>
                      <div className="flex justify-between border-b border-gray-200 pb-2"><span>Govt ID</span> <span className="font-mono text-gray-900">{currentUser.aadhar}</span></div>
                      <div className="flex justify-between pt-1"><span>Current Status</span> <span className="text-yellow-600 font-black uppercase bg-yellow-50 px-2 py-0.5 rounded">Pending Verification</span></div>
                    </div>
                  </div>
                </div>
              );
            }

            if (currentUser.status === 'rejected') {
              return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 bg-gray-50 text-center">
                   <div className="bg-white p-10 rounded-[32px] shadow-xl max-w-lg">
                    <div className="bg-red-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                      <XCircle className="w-10 h-10 text-red-600" />
                    </div>
                    <h2 className="text-2xl font-bold mb-2 text-red-600">Application Rejected</h2>
                    <p className="text-gray-500 mb-6">Unfortunately, your application was not approved.</p>
                    <div className="bg-red-50 p-4 rounded-xl text-red-800 font-medium border border-red-100 mb-6">
                      Reason: {currentUser.rejectionReason}
                    </div>
                    <button className="text-gray-500 underline text-sm">Contact Support</button>
                  </div>
                </div>
              );
            }

            // Active Dashboard
            const myProducts = products.filter(p => p.farmerId === currentUser.uid);

            return (
              <div className="min-h-screen pt-24 pb-12 px-4 bg-gray-50">
                <div className="max-w-6xl mx-auto">
                  <header className="mb-8 flex justify-between items-end">
                    <div>
                      <h1 className="text-3xl font-black text-gray-900">Farmer Dashboard</h1>
                      <p className="text-gray-500">Manage your farm inventory and orders</p>
                    </div>
                    <div className="flex bg-white p-1 rounded-xl shadow-sm border border-gray-100">
                      <button onClick={() => setTab('inventory')} className={`px-6 py-2 rounded-lg font-bold text-sm transition-all ${tab === 'inventory' ? 'bg-green-600 text-white' : 'text-gray-500'}`}>My Inventory</button>
                      <button onClick={() => setTab('orders')} className={`px-6 py-2 rounded-lg font-bold text-sm transition-all ${tab === 'orders' ? 'bg-green-600 text-white' : 'text-gray-500'}`}>Incoming Orders</button>
                    </div>
                  </header>

                  {tab === 'inventory' ? (
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                      {/* Add Product Form */}
                      <div className="lg:col-span-1">
                        <div className="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 sticky top-28">
                          <h3 className="text-xl font-bold mb-4 flex items-center gap-2"><Upload className="w-5 h-5 text-green-600"/> Add New Product</h3>
                          <form className="space-y-4" onSubmit={(e) => { e.preventDefault(); addProduct(newProd); setNewProd({ name: '', price: '', stock: '', unit: 'kg', pesticides: false, description: '' }); }}>
                            <div>
                              <label className="text-xs font-bold text-gray-500 uppercase">Product Name</label>
                              <input required className="input-field w-full px-4 py-2 rounded-lg border border-gray-200" value={newProd.name} onChange={e => setNewProd({...newProd, name: e.target.value})} placeholder="e.g. Red Potatoes" />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                              <div>
                                <label className="text-xs font-bold text-gray-500 uppercase">Price</label>
                                <input required type="number" className="w-full px-4 py-2 rounded-lg border border-gray-200" value={newProd.price} onChange={e => setNewProd({...newProd, price: Number(e.target.value)})} placeholder="0.00" />
                              </div>
                              <div>
                                <label className="text-xs font-bold text-gray-500 uppercase">Unit</label>
                                <select className="w-full px-4 py-2 rounded-lg border border-gray-200 bg-white" value={newProd.unit} onChange={e => setNewProd({...newProd, unit: e.target.value})}>
                                  <option value="kg">Per Kg</option>
                                  <option value="gram">Per 500g</option>
                                  <option value="bunch">Per Bunch</option>
                                  <option value="piece">Per Piece</option>
                                  <option value="liter">Per Liter</option>
                                </select>
                              </div>
                            </div>
                            <div>
                              <label className="text-xs font-bold text-gray-500 uppercase">Stock Available</label>
                              <input required type="number" className="w-full px-4 py-2 rounded-lg border border-gray-200" value={newProd.stock} onChange={e => setNewProd({...newProd, stock: Number(e.target.value)})} placeholder="Total quantity" />
                            </div>
                            <div>
                               <label className="text-xs font-bold text-gray-500 uppercase">Description</label>
                               <textarea className="w-full px-4 py-2 rounded-lg border border-gray-200 h-20" value={newProd.description} onChange={e => setNewProd({...newProd, description: e.target.value})} placeholder="Freshness details..." />
                            </div>
                            <div className="flex items-center gap-2 p-3 bg-gray-50 rounded-xl">
                              <input type="checkbox" id="pest" checked={newProd.pesticides} onChange={e => setNewProd({...newProd, pesticides: e.target.checked})} className="w-5 h-5 text-green-600 rounded focus:ring-green-500" />
                              <label htmlFor="pest" className="text-sm font-medium text-gray-700">Pesticides/Chemicals Used?</label>
                            </div>
                            <button className="w-full py-3 bg-green-700 text-white font-bold rounded-xl hover:bg-green-800 transition-all">Publish Product</button>
                          </form>
                        </div>
                      </div>

                      {/* Product List */}
                      <div className="lg:col-span-2 space-y-4">
                        {myProducts.length === 0 ? (
                          <div className="text-center py-20 bg-white rounded-3xl border border-dashed border-gray-200">
                            <p className="text-gray-400 font-medium">No products listed yet.</p>
                          </div>
                        ) : (
                          myProducts.map(p => (
                            <div key={p.id} className="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex justify-between items-center">
                              <div>
                                <h4 className="text-lg font-bold text-gray-900">{p.name}</h4>
                                <div className="flex gap-4 text-sm text-gray-500 mt-1">
                                  <span>Stock: <strong className={p.stock < 10 ? 'text-red-500' : 'text-green-600'}>{p.stock} {p.unit}</strong></span>
                                  <span>Price: <strong>${p.price}/{p.unit}</strong></span>
                                </div>
                                <div className="mt-2 text-xs">
                                   {p.pesticides ? <span className="text-red-500 bg-red-50 px-2 py-1 rounded-md font-bold">Contains Chemicals</span> : <span className="text-green-600 bg-green-50 px-2 py-1 rounded-md font-bold">Organic / Chemical Free</span>}
                                </div>
                              </div>
                              <div className="text-2xl font-bold text-gray-200">#{p.id.toString().slice(-4)}</div>
                            </div>
                          ))
                        )}
                      </div>
                    </div>
                  ) : (
                    <div className="space-y-6">
                      {myOrders.length === 0 ? (
                         <div className="text-center py-20 bg-white rounded-3xl border border-dashed border-gray-200">
                            <p className="text-gray-400 font-medium">No orders received yet.</p>
                          </div>
                      ) : (
                        myOrders.map(order => (
                          <div key={order.id} className="bg-white p-6 rounded-3xl shadow-sm border border-gray-100">
                            <div className="flex justify-between items-start mb-4 border-b border-gray-50 pb-4">
                              <div>
                                <h4 className="font-bold text-lg">Order {order.id}</h4>
                                <p className="text-sm text-gray-500">{new Date(order.date).toLocaleDateString()}</p>
                              </div>
                              <span className="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-bold uppercase">{order.status}</span>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                              <div>
                                <h5 className="text-xs font-bold text-gray-400 uppercase mb-2">Customer Details</h5>
                                <p className="font-medium text-gray-900">{order.customerName}</p>
                                <p className="text-sm text-gray-500 flex items-start gap-1 mt-1"><MapPin className="w-4 h-4 mt-0.5 shrink-0"/> {order.address}</p>
                              </div>
                              <div>
                                <h5 className="text-xs font-bold text-gray-400 uppercase mb-2">Items Ordered</h5>
                                <ul className="space-y-2">
                                  {order.items.map((item, idx) => (
                                    <li key={idx} className="flex justify-between text-sm">
                                      <span>{item.name} x {item.quantity} {item.unit}</span>
                                      <span className="font-bold">${(item.price * item.quantity).toFixed(2)}</span>
                                    </li>
                                  ))}
                                </ul>
                                <div className="mt-4 pt-2 border-t border-gray-100 flex justify-between font-black text-lg text-green-700">
                                   <span>Earnings</span>
                                   <span>${order.items.reduce((sum, i) => sum + (i.price * i.quantity), 0).toFixed(2)}</span>
                                </div>
                              </div>
                            </div>
                          </div>
                        ))
                      )}
                    </div>
                  )}
                </div>
              </div>
            );
          };

          const ModDashboard = () => {
            const [pendingUsers, setPendingUsers] = useState([]);
            const [rejectReason, setRejectReason] = useState("");
            const [selectedUser, setSelectedUser] = useState(null);

            useEffect(() => {
                const q = query(collection(db, "users"), where("status", "==", "pending"));
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    setPendingUsers(snapshot.docs.map(doc => ({id: doc.id, ...doc.data()})));
                });
                return () => unsubscribe();
            }, []);

            return (
              <div className="min-h-screen pt-24 pb-12 px-4 bg-slate-50">
                <div className="max-w-5xl mx-auto">
                  <div className="bg-slate-900 text-white p-8 rounded-[32px] mb-8 flex justify-between items-center shadow-xl">
                    <div>
                      <h1 className="text-3xl font-black mb-2">Moderator Panel</h1>
                      <p className="text-slate-400">Review pending verifications</p>
                    </div>
                    <div className="bg-white/10 px-6 py-3 rounded-2xl backdrop-blur-md">
                      <span className="text-2xl font-bold">{pendingUsers.length}</span>
                      <span className="text-slate-400 ml-2 text-sm">Pending</span>
                    </div>
                  </div>

                  <div className="grid grid-cols-1 gap-6">
                    {pendingUsers.length === 0 ? (
                       <div className="text-center py-20 bg-white rounded-3xl border border-dashed border-gray-200">
                          <CheckCircle className="w-12 h-12 text-green-200 mx-auto mb-4" />
                          <p className="text-gray-400 font-medium">All caught up! No pending applications.</p>
                        </div>
                    ) : (
                      pendingUsers.map(user => (
                        <div key={user.id} className="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 flex flex-col md:flex-row gap-6">
                          <div className="flex-1 space-y-3">
                            <div className="flex items-center gap-3">
                              <div className="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold text-xl">
                                {user.name[0]}
                              </div>
                              <div>
                                <h3 className="font-bold text-lg text-gray-900">{user.name}</h3>
                                <p className="text-gray-500 text-sm">{user.email}</p>
                                <span className="text-xs bg-gray-100 px-2 py-1 rounded text-gray-500 uppercase font-bold">{user.role}</span>
                              </div>
                            </div>
                            <div className="grid grid-cols-2 gap-4 text-sm mt-4 bg-gray-50 p-4 rounded-xl">
                              <div>
                                <span className="text-gray-400 block text-xs uppercase font-bold">Phone</span>
                                <span className="font-medium">{user.phone}</span>
                              </div>
                              {user.role === 'farmer' && (
                                <div>
                                    <span className="text-gray-400 block text-xs uppercase font-bold">Govt ID / Aadhar</span>
                                    <span className="font-mono bg-white px-2 py-0.5 rounded border text-gray-700">{user.aadhar}</span>
                                </div>
                              )}
                              <div className="col-span-2">
                                <span className="text-gray-400 block text-xs uppercase font-bold mb-1">Documents</span>
                                {user.docUrl ? (
                                    <a href={user.docUrl} target="_blank" className="flex items-center gap-2 text-blue-600 bg-blue-50 p-2 rounded-lg cursor-pointer hover:bg-blue-100 transition-colors">
                                        <FileText className="w-4 h-4" />
                                        <span className="text-xs font-bold underline">View Document</span>
                                    </a>
                                ) : (
                                    <span className="text-gray-400 italic text-xs">No document uploaded</span>
                                )}
                              </div>
                            </div>
                          </div>

                          <div className="flex flex-col justify-center gap-3 md:w-64 border-l pl-0 md:pl-6 border-gray-100">
                            {selectedUser === user.id ? (
                              <div className="animate-in fade-in zoom-in duration-200">
                                <textarea 
                                  className="w-full text-sm p-3 border rounded-xl mb-2 focus:ring-2 focus:ring-red-200 outline-none" 
                                  placeholder="Reason for rejection..." 
                                  value={rejectReason}
                                  onChange={e => setRejectReason(e.target.value)}
                                />
                                <div className="flex gap-2">
                                  <button 
                                    onClick={() => { handleModAction(user.id, 'reject', rejectReason); setSelectedUser(null); setRejectReason(""); }}
                                    className="flex-1 bg-red-600 text-white py-2 rounded-lg text-sm font-bold hover:bg-red-700"
                                  >
                                    Confirm
                                  </button>
                                  <button 
                                    onClick={() => setSelectedUser(null)}
                                    className="px-3 py-2 bg-gray-200 rounded-lg text-sm font-bold hover:bg-gray-300"
                                  >
                                    Cancel
                                  </button>
                                </div>
                              </div>
                            ) : (
                              <>
                                <button 
                                  onClick={() => handleModAction(user.id, 'approve')}
                                  className="w-full py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 flex items-center justify-center gap-2 shadow-lg shadow-green-100"
                                >
                                  <CheckCircle className="w-5 h-5" /> Approve
                                </button>
                                <button 
                                  onClick={() => setSelectedUser(user.id)}
                                  className="w-full py-3 bg-white border-2 border-red-100 text-red-600 rounded-xl font-bold hover:bg-red-50 flex items-center justify-center gap-2"
                                >
                                  <XCircle className="w-5 h-5" /> Reject
                                </button>
                              </>
                            )}
                          </div>
                        </div>
                      ))
                    )}
                  </div>
                </div>
              </div>
            );
          };

          const BuyerMarketplace = () => {
            const [cart, setCart] = useState([]);
            const [searchTerm, setSearchTerm] = useState("");
            
            const addToCart = (product) => {
              if(product.stock <= 0) return;
              
              const existing = cart.find(c => c.id === product.id);
              if(existing) {
                if(existing.quantity >= product.stock) return showNotification("Max stock reached", "error");
                setCart(cart.map(c => c.id === product.id ? {...c, quantity: c.quantity + 1} : c));
              } else {
                setCart([...cart, {...product, quantity: 1}]);
              }
              showNotification("Added to cart", "success");
            };

            const cartTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            // Filter products
            const filteredProducts = products.filter(p => p.name.toLowerCase().includes(searchTerm.toLowerCase()));

            return (
              <div className="min-h-screen pt-24 pb-12 px-4 bg-gray-50">
                <div className="max-w-7xl mx-auto flex flex-col md:flex-row gap-8">
                  
                  {/* Product Grid */}
                  <div className="flex-1">
                     <div className="mb-8 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                       <div>
                         <h1 className="text-3xl font-black text-gray-900">Marketplace</h1>
                         <p className="text-gray-500">Fresh produce directly from verified farmers</p>
                       </div>
                       <div className="relative w-full md:w-64">
                         <input 
                           type="text" 
                           placeholder="Search products..." 
                           className="w-full pl-10 pr-4 py-3 rounded-xl border-none shadow-sm focus:ring-2 focus:ring-green-500"
                           value={searchTerm}
                           onChange={(e) => setSearchTerm(e.target.value)}
                         />
                         <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
                       </div>
                     </div>

                     {filteredProducts.length === 0 ? (
                        <div className="text-center py-32 bg-white rounded-[40px] shadow-sm">
                          <Package className="w-16 h-16 text-gray-200 mx-auto mb-4" />
                          <h3 className="text-xl font-bold text-gray-400">No products found</h3>
                          <p className="text-gray-400">Try adjusting your search terms.</p>
                        </div>
                     ) : (
                       <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                         {filteredProducts.map(p => (
                           <div key={p.id} className={`bg-white p-5 rounded-3xl border border-gray-100 transition-all ${p.stock === 0 ? 'opacity-60' : 'hover:shadow-xl hover:-translate-y-1'}`}>
                              <div className="flex justify-between items-start mb-4">
                                <div className="bg-green-100 text-green-800 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide">
                                  {p.pesticides ? 'Non-Organic' : 'Organic'}
                                </div>
                                <div className="text-xs font-bold text-gray-400">By {p.farmerName}</div>
                              </div>
                              <h3 className="font-bold text-xl text-gray-900 mb-1">{p.name}</h3>
                              <p className="text-gray-500 text-sm line-clamp-2 h-10 mb-4">{p.description}</p>
                              
                              <div className="flex items-center justify-between mt-auto">
                                <div>
                                  <span className="block text-2xl font-black text-gray-900">${p.price}</span>
                                  <span className="text-xs text-gray-400 font-bold uppercase">Per {p.unit}</span>
                                </div>
                                {p.stock > 0 ? (
                                   <button 
                                     onClick={() => addToCart(p)}
                                     className="bg-gray-900 text-white p-3 rounded-xl hover:bg-green-600 transition-colors shadow-lg active:scale-95"
                                   >
                                     <ShoppingCart className="w-5 h-5" />
                                   </button>
                                ) : (
                                  <span className="bg-red-100 text-red-600 px-3 py-1 rounded-lg text-xs font-bold uppercase">Out of Stock</span>
                                )}
                              </div>
                              <div className="mt-4 pt-3 border-t border-gray-100 text-xs font-medium text-gray-400 flex items-center gap-1">
                                <Package className="w-3 h-3" /> {p.stock} {p.unit} available
                              </div>
                           </div>
                         ))}
                       </div>
                     )}
                  </div>

                  {/* Cart Sidebar */}
                  <div className="w-full md:w-96">
                    <div className="bg-white p-6 rounded-3xl shadow-xl border border-green-100 sticky top-24">
                      <h2 className="text-xl font-bold mb-6 flex items-center gap-2">
                        <ShoppingCart className="w-5 h-5 text-green-600"/> Your Cart
                      </h2>
                      
                      {cart.length === 0 ? (
                        <p className="text-gray-400 text-center py-8 text-sm">Your cart is empty.</p>
                      ) : (
                        <div className="space-y-4">
                          {cart.map((item, idx) => (
                            <div key={idx} className="flex justify-between items-center text-sm">
                              <div>
                                <div className="font-bold">{item.name}</div>
                                <div className="text-gray-500 text-xs">{item.quantity} {item.unit} x ${item.price}</div>
                              </div>
                              <div className="font-bold">${(item.quantity * item.price).toFixed(2)}</div>
                            </div>
                          ))}
                          <div className="border-t border-dashed border-gray-200 pt-4 mt-4">
                            <div className="flex justify-between text-lg font-black text-gray-900">
                              <span>Total</span>
                              <span>${cartTotal.toFixed(2)}</span>
                            </div>
                          </div>
                          <button 
                            onClick={() => { placeOrder(cart, cartTotal); setCart([]); }}
                            className="w-full py-4 bg-green-600 text-white font-bold rounded-xl shadow-lg shadow-green-200 hover:bg-green-700 active:scale-95 transition-all"
                          >
                            Confirm Order
                          </button>
                        </div>
                      )}
                    </div>
                  </div>

                </div>
              </div>
            );
          };

          const Hero = () => (
            <section className="relative pt-32 pb-20 lg:pt-48 lg:pb-32 overflow-hidden bg-white">
              <div className="absolute top-0 right-0 w-1/2 h-full bg-green-50/50 -z-10 rounded-l-[100px]" />
              <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col lg:flex-row items-center gap-16 relative z-10">
                <div className="flex-1 space-y-8 text-center lg:text-left">
                  <div className="inline-flex items-center gap-2 bg-green-100 text-green-800 px-4 py-1.5 rounded-full text-sm font-bold tracking-wide uppercase">
                    <Star className="w-4 h-4 fill-green-800" />
                    Voted #1 Farm-to-Table App
                  </div>
                  <h1 className="text-5xl md:text-7xl font-extrabold text-gray-900 leading-[1.1]">
                    Fresh Farm Produce <br />
                    <span className="text-transparent bg-clip-text bg-gradient-to-r from-green-600 to-emerald-500">Delivered to <br /> Your Door</span>
                  </h1>
                  <p className="text-lg text-gray-500 max-w-xl mx-auto lg:mx-0 leading-relaxed">
                    Connect directly with local farmers. Farmers set the prices, you get the freshness.
                    100% Transparency.
                  </p>
                  <div className="flex flex-col sm:flex-row items-center justify-center lg:justify-start gap-4">
                    <button 
                      onClick={() => !currentUser ? setView('auth') : setView('marketplace')}
                      className="group bg-green-700 text-white px-8 py-4 rounded-2xl font-bold text-lg hover:bg-green-800 transition-all flex items-center gap-2 shadow-xl shadow-green-100"
                    >
                      {currentUser ? 'Shop Now' : 'Join Community'}
                      <ArrowRight className="group-hover:translate-x-1 transition-transform" />
                    </button>
                  </div>
                </div>
                
                {/* Live Product Showcase */}
                <div className="flex-1 relative w-full">
                   <div className="bg-white/80 backdrop-blur-md p-6 rounded-[40px] shadow-2xl border border-white relative z-10 max-w-md mx-auto transform rotate-2 hover:rotate-0 transition-all duration-500">
                      <div className="flex justify-between items-center mb-6">
                        <h3 className="font-bold text-xl">Fresh Arrivals</h3>
                        <span className="text-xs font-bold text-green-600 bg-green-50 px-2 py-1 rounded-full animate-pulse">LIVE</span>
                      </div>
                      <div className="space-y-4">
                        {products.slice(0, 3).map((p, i) => (
                          <div key={i} className="flex items-center gap-4 p-3 hover:bg-gray-50 rounded-2xl transition-colors cursor-pointer group" onClick={() => setView('marketplace')}>
                            <div className="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center text-xl">
                              🥬
                            </div>
                            <div className="flex-1">
                              <h4 className="font-bold text-gray-900">{p.name}</h4>
                              <p className="text-xs text-gray-500">{p.farmerName}</p>
                            </div>
                            <div className="text-right">
                              <span className="block font-black text-green-700">${p.price}</span>
                              <span className="text-[10px] text-gray-400 font-bold uppercase">/{p.unit}</span>
                            </div>
                          </div>
                        ))}
                        {products.length === 0 && (
                          <div className="text-center py-8 text-gray-400 text-sm">
                            Loading fresh produce...
                          </div>
                        )}
                      </div>
                      <button onClick={() => setView('marketplace')} className="w-full mt-6 py-3 bg-gray-900 text-white rounded-xl font-bold text-sm hover:bg-black transition-all">
                        View All Products
                      </button>
                   </div>
                   
                   {/* Background Elements */}
                   <div className="absolute top-10 -right-10 bg-green-200 w-72 h-72 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob"></div>
                   <div className="absolute -bottom-10 -left-10 bg-yellow-200 w-72 h-72 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-2000"></div>
                </div>
              </div>
            </section>
          );

          if (loading) {
            return (
              <div className="min-h-screen flex items-center justify-center bg-white">
                <div className="animate-spin text-green-600">
                  <Loader2 className="w-12 h-12" />
                </div>
              </div>
            );
          }

          return (
            <div className="font-sans text-gray-900 antialiased selection:bg-green-100 selection:text-green-900 min-h-screen flex flex-col">
              <Navbar />
              
              {/* Toast Notification */}
              {notification && (
                <div className={`fixed bottom-4 right-4 z-50 px-6 py-4 rounded-xl text-white font-bold shadow-2xl animate-in slide-in-from-bottom-5 ${notification.type === 'error' ? 'bg-red-600' : 'bg-green-700'}`}>
                  {notification.msg}
                </div>
              )}

              <main className="flex-grow">
                {view === 'home' && (
                  <>
                    <Hero />
                    <FeaturesSection />
                  </>
                )}
                
                {view === 'about' && <AboutUs />}
                {view === 'auth' && <AuthScreen />}
                
                {view === 'dashboard' && currentUser?.role === 'farmer' && <FarmerDashboard />}
                {view === 'dashboard' && currentUser?.role === 'mod' && <ModDashboard />}
                {view === 'dashboard' && currentUser?.role === 'buyer' && <BuyerMarketplace />}
                
                {view === 'marketplace' && <BuyerMarketplace />}
              </main>

              {(view === 'home' || view === 'marketplace' || view === 'about') && <Footer />}

            </div>
          );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
